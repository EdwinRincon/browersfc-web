<mat-card class="teams-card shadow-xs">
  <!-- Skip link for keyboard navigation -->
  <a class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-browers-deep-purple text-browers-white px-4 py-2 rounded z-50"
     href="#teams-content">Skip to teams content</a>

  <mat-card-header class="border-b border-browers-light-grey pb-4">
    <mat-card-title class="text-browers-deep-purple text-xl font-semibold">Teams Management</mat-card-title>
    <mat-card-subtitle class="text-browers-dark-grey mt-1">View and manage football teams</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="pt-6" id="teams-content">
    <!-- Loading skeleton with screen reader announcements -->
    @if (loading()) {
      <!-- Screen reader announcement for loading state -->
      <div class="sr-only" aria-live="polite">Loading teams data, please wait...</div>

      <!-- Desktop Skeleton -->
      @if (!isMobile()) {
        <div class="skeleton-table" aria-hidden="true">
          <div class="skeleton-header bg-browers-light-grey h-12 mb-1"></div>
          @for (i of [1,2,3,4,5]; track i) {
            <div class="skeleton-row flex space-x-4 h-14 p-4 border-b border-browers-light-grey">
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-32 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-24 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
            </div>
          }
        </div>
      }

      <!-- Mobile Skeleton -->
      @if (isMobile()) {
        <div class="skeleton-cards space-y-4" aria-hidden="true">
          @for (i of [1,2,3]; track i) {
            <mat-card class="skeleton-card bg-browers-white shadow-xs border border-browers-light-grey">
              <mat-card-content class="p-4">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <div class="skeleton-text bg-browers-silver h-5 w-32 rounded animate-pulse mb-2"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
                  </div>
                  <div class="skeleton-shield bg-browers-silver h-12 w-12 rounded animate-pulse"></div>
                </div>

                <div class="space-y-2 mb-4">
                  <div class="flex justify-between">
                    <div class="skeleton-text bg-browers-silver h-4 w-8 rounded animate-pulse"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-20 rounded animate-pulse"></div>
                  </div>
                  <div class="flex justify-between">
                    <div class="skeleton-text bg-browers-silver h-4 w-16 rounded animate-pulse"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
                  </div>
                </div>

                <div class="flex space-x-2">
                  <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
                  <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
    }

    <!-- Error message -->
    @if (error(); as err) {
      <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
        <mat-icon aria-hidden="true">error</mat-icon>
        <span class="font-medium">Error:</span>
        <span>{{ err }}</span>
      </div>
    }

    <!-- Teams table/cards -->
    @if (!loading() && !error() && dataSource.data.length > 0) {
      <!-- Desktop Table View -->
      @if (!isMobile()) {
        <div class="table-container">
          <table
            mat-table
            [dataSource]="dataSource"
            matSort
            matSortDisableClear
            [matSortActive]="paginationParams().sort ?? 'full_name'"
            [matSortDirection]="paginationParams().order ?? 'asc'"
            #sort="matSort"
            (matSortChange)="onSortChange($event)"
            class="teams-table"
            aria-label="Teams management table with sorting and pagination">

      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="id"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">ID</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal font-mono">{{ team.id }}</td>
      </ng-container>

      <!-- Full Name Column -->
      <ng-container matColumnDef="full_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="full_name"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Full Name</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal font-semibold">{{ team.full_name }}</td>
      </ng-container>

      <!-- Short Name Column -->
      <ng-container matColumnDef="short_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="short_name"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Short Name</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal font-medium">{{ team.short_name }}</td>
      </ng-container>

      <!-- Primary Color Column -->
      <ng-container matColumnDef="color">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="color"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Primary Color</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal">
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded border border-browers-silver" [style.background-color]="team.color"></div>
                  <span class="font-mono text-sm">{{ team.color }}</span>
                </div>
              </td>
            </ng-container>

      <!-- Secondary Color Column -->
      <ng-container matColumnDef="color2">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="color2"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Secondary Color</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal">
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded border border-browers-silver" [style.background-color]="team.color2"></div>
                  <span class="font-mono text-sm">{{ team.color2 }}</span>
                </div>
              </td>
            </ng-container>

      <!-- Shield Column -->
      <ng-container matColumnDef="shield">
        <th mat-header-cell *matHeaderCellDef
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Shield</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal">
                <img [src]="team.shield" [alt]="team.full_name + ' shield'" class="w-8 h-8 object-contain">
              </td>
            </ng-container>

      <!-- Next Match Column -->
      <ng-container matColumnDef="next_match">
        <th mat-header-cell *matHeaderCellDef
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Next Match</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-charcoal">
                <span [ngClass]="{
                  'next-match-scheduled': hasNextMatch(team),
                  'no-next-match': hasNoNextMatch(team)
                }">
                  {{ getNextMatchDisplay(team) }}
                </span>
              </td>
            </ng-container>

      <!-- Created At Column -->
      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="created_at"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Created</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-dark-grey text-sm">{{ formatDate(team.created_at) }}</td>
      </ng-container>

      <!-- Updated At Column -->
      <ng-container matColumnDef="updated_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="updated_at"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Updated</th>
        <td mat-cell *matCellDef="let team"
          class="text-browers-dark-grey text-sm">{{ formatDate(team.updated_at) }}</td>
      </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef
                  class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Actions</th>
              <td mat-cell *matCellDef="let team"
                  class="space-x-1">
                <button
                  mat-icon-button
                  color="primary"
                  [matTooltip]="'Edit ' + team.full_name"
                  (click)="updateTeam(team.id, team)"
                  aria-label="Edit team">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  [matTooltip]="'Delete ' + team.full_name"
                  (click)="deleteTeam(team.id)"
                  aria-label="Delete team">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-browers-light-grey sticky top-0 z-10"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-browers-light-grey hover:bg-opacity-50 transition-colors duration-150"></tr>
          </table>
        </div>
      }

      <!-- Mobile Card View -->
      @if (isMobile()) {
        <div class="mobile-cards-container space-y-4">
          @for (team of dataSource.data; track team.id) {
            <mat-card class="team-card bg-browers-white shadow-xs border border-browers-light-grey hover:shadow-md transition-shadow duration-200">
              <mat-card-content class="p-4">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <h3 class="text-lg font-semibold text-browers-deep-purple">{{ team.full_name }}</h3>
                    <p class="text-browers-dark-grey text-sm">{{ team.short_name }}</p>
                  </div>
                  <img [src]="team.shield" [alt]="team.full_name + ' shield'" class="w-12 h-12 object-contain">
                </div>

                <div class="grid grid-cols-1 gap-2 text-sm mb-4">
                  <div class="flex justify-between">
                    <span class="text-browers-steel-grey font-medium">ID:</span>
                    <span class="text-browers-charcoal font-mono">{{ team.id }}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-browers-steel-grey font-medium">Colors:</span>
                    <div class="flex gap-1">
                      <div class="w-4 h-4 rounded border border-browers-silver" [style.background-color]="team.color"></div>
                      <div class="w-4 h-4 rounded border border-browers-silver" [style.background-color]="team.color2"></div>
                    </div>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-browers-steel-grey font-medium">Next Match:</span>
                    <span class="text-browers-dark-grey text-xs" [ngClass]="{
                      'next-match-scheduled': hasNextMatch(team),
                      'no-next-match': hasNoNextMatch(team)
                    }">{{ getNextMatchDisplay(team) }}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-browers-steel-grey font-medium">Created:</span>
                    <span class="text-browers-dark-grey">{{ formatDate(team.created_at) }}</span>
                  </div>
                </div>

                <div class="flex space-x-2 justify-end">
                  <button
                    mat-stroked-button
                    color="primary"
                    [matTooltip]="'Edit ' + team.full_name"
                    (click)="updateTeam(team.id, team)"
                    class="flex-1"
                    aria-label="Edit team">
                    <mat-icon class="mr-1">edit</mat-icon>
                    Edit
                  </button>
                  <button
                    mat-stroked-button
                    color="warn"
                    [matTooltip]="'Delete ' + team.full_name"
                    (click)="deleteTeam(team.id)"
                    class="flex-1"
                    aria-label="Delete team">
                    <mat-icon class="mr-1">delete</mat-icon>
                    Delete
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }

      <!-- Paginator (responsive) -->
      <mat-paginator
        #paginator
        [length]="totalTeams()"
        [pageSize]="paginationParams().pageSize"
        [pageIndex]="paginationParams().page"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        [showFirstLastButtons]="!isMobile()"
        aria-label="Select page of teams"
        class="border-t border-browers-light-grey bg-browers-white mt-4">
      </mat-paginator>
    }

    <!-- No data message -->
    @if (!loading() && !error() && dataSource.data.length === 0) {
      <div class="no-data-message">
        <mat-icon class="text-browers-silver text-6xl mb-4">groups</mat-icon>
        <p class="text-browers-steel-grey text-lg">No teams found.</p>
        <p class="text-browers-steel-grey text-sm">Teams will appear here when they are added to the system.</p>
      </div>
    }
  </mat-card-content>
</mat-card>