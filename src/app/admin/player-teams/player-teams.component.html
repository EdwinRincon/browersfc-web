<div class="p-4 lg:p-6">
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
    <div>
      <h1 class="text-2xl lg:text-3xl font-bold text-browers-black mb-2">Player Teams</h1>
      <p class="text-browers-steel-grey">Manage player-team relationships</p>
    </div>
    <button mat-flat-button color="primary" class="mt-4 lg:mt-0 bg-browers-deep-purple hover:bg-browers-purple" (click)="addRelationship()">
      <mat-icon>add</mat-icon>
      Add Relationship
    </button>
  </div>

  @if (loading()) {
    <div class="flex justify-center items-center py-12">
      <mat-spinner diameter="48"></mat-spinner>
    </div>
  }

  <!-- Error message -->
  @if (error(); as err) {
    <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
      <mat-icon aria-hidden="true">error</mat-icon>
      <span class="font-medium">Error:</span>
      <span>{{ err }}</span>
    </div>
  }

  @if (!loading()) {
    <div class="bg-white rounded-lg border border-browers-light-grey overflow-hidden">
      <table mat-table [dataSource]="dataSource.data"
  matSort
  matSortDisableClear
  [matSortActive]="paginationParams().sort ?? 'id'"
  [matSortDirection]="paginationParams().order ?? 'desc'"
  #sort="matSort"
  (matSortChange)="onSortChange($event)"
  class="w-full">
        
        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="player" class="bg-browers-light-grey text-browers-black font-semibold">Player</th>
          <td mat-cell *matCellDef="let relationship">
            <div class="flex items-center space-x-2">
              <div class="w-6 h-6 bg-browers-lavender rounded-full flex items-center justify-center">
                <span class="text-white font-bold text-xs">{{ relationship.player.nick_name.charAt(0).toUpperCase() }}</span>
              </div>
              <span class="font-medium text-browers-black">{{ relationship.player.nick_name }}</span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="team">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="team" class="bg-browers-light-grey text-browers-black font-semibold">Team</th>
          <td mat-cell *matCellDef="let relationship">
            <div class="flex items-center space-x-2">
              <div class="w-6 h-6 bg-browers-deep-purple rounded-full"></div>
              <span class="font-medium text-browers-black">{{ relationship.team.short_name }}</span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="period">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="period" class="bg-browers-light-grey text-browers-black font-semibold">Period</th>
          <td mat-cell *matCellDef="let relationship">
            <div class="text-sm">
              <p class="text-browers-black">{{ relationship.start_date | date:'MMM y' }}</p>
              <p class="text-browers-steel-grey">{{ relationship.end_date ? (relationship.end_date | date:'MMM y') : 'Present' }}</p>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="status" class="bg-browers-light-grey text-browers-black font-semibold">Status</th>
          <td mat-cell *matCellDef="let relationship">
            @if (relationship.active ?? true) {
              <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
                Active
              </span>
            } @else {
              <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                Inactive
              </span>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="bg-browers-light-grey text-browers-black font-semibold">Actions</th>
          <td mat-cell *matCellDef="let relationship">
            <div class="flex space-x-2">
              <button mat-icon-button class="text-browers-deep-purple hover:bg-browers-light-grey" (click)="editRelationship(relationship)" matTooltip="Edit relationship">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button class="text-red-600 hover:bg-red-50" (click)="deleteRelationship(relationship)" matTooltip="Delete relationship">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-browers-light-grey transition-colors"></tr>
      </table>

      <div class="border-t border-browers-light-grey px-4 py-3">
        <mat-paginator
          [length]="totalCount"
          [pageSize]="paginationParams().pageSize"
          [pageIndex]="paginationParams().page"
          [pageSizeOptions]="pageSizeOptions"
          (page)="onPageChange($event)"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </div>

    @if (dataSource.data.length === 0 && !loading()) {
      <div class="text-center py-12">
        <mat-icon class="text-browers-silver text-6xl mb-4">group_work</mat-icon>
        <h3 class="text-xl font-medium text-browers-black mb-2">No relationships found</h3>
        <p class="text-browers-steel-grey mb-6">Get started by adding player-team relationships.</p>
        <button mat-flat-button color="primary" class="bg-browers-deep-purple hover:bg-browers-purple" (click)="addRelationship()">
          <mat-icon>add</mat-icon>
          Add First Relationship
        </button>
      </div>
    }
  }
