<!-- Admin Matches - Following Users Template Pattern -->
<div class="admin-matches">
  <!-- Header Section with Title and Actions -->
  <div class="header-section mb-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
      <div>
        <h1 class="text-2xl lg:text-3xl font-bold text-browers-black mb-2">Match Management</h1>
        <p class="text-browers-steel-grey">Manage team matches, fixtures, and results</p>
      </div>

      <div class="flex items-center gap-3 mt-4 lg:mt-0">
        <button mat-flat-button color="primary" (click)="addMatch()"
          class="bg-browers-deep-purple text-browers-white hover:bg-browers-purple">
          <mat-icon>add</mat-icon>
          Add Match
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Card -->
  <mat-card class="main-content-card">
    <!-- Error message -->
    @if (paginatedMatches.error(); as err) {
    <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
      <mat-icon aria-hidden="true">error</mat-icon>
      <span class="font-medium">Error:</span>
      <span>{{ err.message }}</span>
    </div>
    }

    <!-- Loading State -->
    @if (paginatedMatches.isLoading()) {
    <div class="loading-container">
      <!-- Header Skeleton -->
      <div class="flex justify-between items-center mb-4">
        <div class="skeleton-line w-32 h-6"></div>
        <div class="skeleton-line w-24 h-6"></div>
      </div>

      <!-- Table Header Skeleton -->
      <div class="hidden lg:block mb-4">
        <div class="grid grid-cols-7 gap-4 p-4 bg-browers-light-grey rounded-t-lg">
          @for (col of displayedColumns; track col) {
          <div class="skeleton-line h-4"></div>
          }
        </div>
      </div>

      <!-- Table Rows Skeleton -->
      <div class="space-y-2">
        @for (item of [1,2,3,4,5]; track item) {
        <!-- Desktop Row Skeleton -->
        <div class="hidden lg:grid lg:grid-cols-7 lg:gap-4 lg:p-4 lg:border-b lg:border-browers-light-grey">
          @for (col of displayedColumns; track col) {
          <div class="skeleton-line h-4"></div>
          }
        </div>

        <!-- Mobile Card Skeleton -->
        <div class="block lg:hidden p-4 border border-browers-light-grey rounded-lg">
          <div class="skeleton-line w-3/4 h-5 mb-2"></div>
          <div class="skeleton-line w-1/2 h-4 mb-3"></div>
          <div class="space-y-2">
            <div class="skeleton-line w-full h-4"></div>
            <div class="skeleton-line w-2/3 h-4"></div>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <!-- Desktop Table View -->
    @if (!paginatedMatches.isLoading() && matchesArray().length > 0) {
    <div class="desktop-table hidden lg:block">
      <div class="overflow-x-auto">
        <table mat-table [dataSource]="matchesArray()" matSort matSortDisableClear
          [matSortActive]="paginationParams().sort ?? 'kickoff'" [matSortDirection]="paginationParams().order ?? 'desc'"
          (matSortChange)="onSortChange($event)" class="w-full"
          aria-label="Matches management table with sorting and pagination">

          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="id"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">ID</th>
            <td mat-cell *matCellDef="let match" class="text-browers-charcoal font-mono">{{ match.id }}</td>
          </ng-container>

          <!-- Kickoff Column -->
          <ng-container matColumnDef="kickoff">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="kickoff"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Date & Time</th>
            <td mat-cell *matCellDef="let match" class="text-browers-charcoal">
              <div class="font-medium">{{ formatDate(match.kickoff) }}</div>
              <div class="text-browers-steel-grey text-xs">{{ formatTime(match.kickoff) }}</div>
            </td>
          </ng-container>

          <!-- Home Team Column -->
          <ng-container matColumnDef="home_team">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="home_team"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Home Team</th>
            <td mat-cell *matCellDef="let match" class="text-browers-charcoal font-medium">
              <div class="flex items-center">
                <div class="w-6 h-6 rounded-full bg-browers-deep-purple mr-2"></div>
                <span>{{ match?.home_team?.short_name || 'TBD' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Away Team Column -->
          <ng-container matColumnDef="away_team">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="away_team"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Away Team</th>
            <td mat-cell *matCellDef="let match" class="text-browers-charcoal font-medium">
              <div class="flex items-center">
                <div class="w-6 h-6 rounded-full bg-browers-purple mr-2"></div>
                <span>{{ match?.away_team?.short_name || 'TBD' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Score Column -->
          <ng-container matColumnDef="score">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="score"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Score</th>
            <td mat-cell *matCellDef="let match" class="text-center">
              @if (match.status === 'finished' && match.home_goals !== undefined && match.away_goals !== undefined) {
              <span class="text-lg font-bold text-browers-black">
                {{ match.home_goals }} - {{ match.away_goals }}
              </span>
              } @else {
              <span class="text-browers-steel-grey">-</span>
              }
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="status"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Status</th>
            <td mat-cell *matCellDef="let match">
              <span class="status-badge status-{{ getStatusColor(match.status) }}">
                {{ getStatusDisplay(match.status) }}
              </span>
            </td>
          </ng-container>

          <!-- Location Column -->
          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="location"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Location</th>
            <td mat-cell *matCellDef="let match">
              <div class="flex items-center">
                <mat-icon class="text-browers-steel-grey mr-1 text-sm">place</mat-icon>
                <span class="text-sm">{{ match.location || 'TBD' }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Season Column -->
          <ng-container matColumnDef="season">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="season"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Season</th>
            <td mat-cell *matCellDef="let match">
              <span class="text-sm">{{ match.season?.year ?? 'N/A' }}</span>
            </td>
          </ng-container>

          <!-- Created At Column -->
          <ng-container matColumnDef="created_at">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="created_at"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Created</th>
            <td mat-cell *matCellDef="let match">
              <span class="text-sm text-browers-steel-grey">{{ formatDate(match.created_at) }}</span>
            </td>
          </ng-container>

          <!-- Updated At Column -->
          <ng-container matColumnDef="updated_at">
            <th mat-header-cell *matHeaderCellDef mat-sort-header="updated_at"
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Updated</th>
            <td mat-cell *matCellDef="let match">
              <span class="text-sm text-browers-steel-grey">{{ formatDate(match.updated_at) }}</span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef
              class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Actions</th>
            <td mat-cell *matCellDef="let match" class="space-x-1">
              <button mat-icon-button color="primary" [matTooltip]="'Edit ' + match.id" (click)="editMatch(match)"
                class="hover:bg-browers-light-purple hover:bg-opacity-10 focus:outline-hidden focus:ring-3 focus:ring-browers-deep-purple focus:ring-offset-1"
                aria-label="Edit match">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" [matTooltip]="'Delete ' + match.id" (click)="deleteMatch(match)"
                class="hover:bg-red-50 focus:outline-hidden focus:ring-3 focus:ring-red-500 focus:ring-offset-1"
                aria-label="Delete match">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-browers-light-grey sticky top-0 z-10"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            class="hover:bg-browers-light-grey hover:bg-opacity-50 transition-colors duration-150"></tr>
        </table>
      </div>
      <div class="pagination-container mt-4 pt-4 border-t border-browers-light-grey">
        <mat-paginator [length]="totalMatches()" [pageSize]="paginationParams().pageSize"
          [pageIndex]="paginationParams().page" [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)"
          showFirstLastButtons aria-label="Select page">
        </mat-paginator>
      </div>
    </div>
    }