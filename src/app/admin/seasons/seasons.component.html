<mat-card class="seasons-card shadow-xs">
  <!-- Skip link for keyboard navigation -->
  <a class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-browers-deep-purple text-browers-white px-4 py-2 rounded z-50"
     href="#seasons-content">Skip to seasons content</a>

  <mat-card-header class="border-b border-browers-light-grey pb-4">
    <mat-card-title class="text-browers-deep-purple text-xl font-semibold">Seasons Management</mat-card-title>
    <mat-card-subtitle class="text-browers-dark-grey mt-1">View and manage football seasons</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="pt-6" id="seasons-content">
    <!-- Loading skeleton with screen reader announcements -->
    @if (loading()) {
      <!-- Screen reader announcement for loading state -->
      <div class="sr-only" aria-live="polite">Loading seasons data, please wait...</div>

      <!-- Desktop Skeleton -->
      @if (!isMobile()) {
        <div class="skeleton-table" aria-hidden="true">
          <div class="skeleton-header bg-browers-light-grey h-12 mb-1"></div>
          @for (i of [1,2,3,4,5]; track i) {
            <div class="skeleton-row flex space-x-4 h-14 p-4 border-b border-browers-light-grey">
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-24 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
              <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
            </div>
          }
        </div>
      }

      <!-- Mobile Skeleton -->
      @if (isMobile()) {
        <div class="skeleton-cards space-y-4" aria-hidden="true">
          @for (i of [1,2,3]; track i) {
            <mat-card class="skeleton-card bg-browers-white shadow-xs border border-browers-light-grey">
              <mat-card-content class="p-4">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <div class="skeleton-text bg-browers-silver h-5 w-32 rounded animate-pulse mb-2"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
                  </div>
                  <div class="skeleton-badge bg-browers-silver h-6 w-16 rounded-full animate-pulse"></div>
                </div>

                <div class="space-y-2 mb-4">
                  <div class="flex justify-between">
                    <div class="skeleton-text bg-browers-silver h-4 w-8 rounded animate-pulse"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-20 rounded animate-pulse"></div>
                  </div>
                  <div class="flex justify-between">
                    <div class="skeleton-text bg-browers-silver h-4 w-16 rounded animate-pulse"></div>
                    <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
                  </div>
                </div>

                <div class="flex space-x-2">
                  <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
                  <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
    }

    <!-- Error message -->
    @if (error(); as err) {
      <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
        <mat-icon aria-hidden="true">error</mat-icon>
        <span class="font-medium">Error:</span>
        <span>{{ err }}</span>
      </div>
    }

    <!-- Seasons table/cards -->
    @if (!loading() && !error() && dataSource.data.length > 0) {
      <!-- Desktop Table View -->
      @if (!isMobile()) {
        <div class="table-container">
          <table
            mat-table
            [dataSource]="dataSource"
            matSort
            matSortDisableClear
            [matSortActive]="paginationParams().sort ?? 'year'"
            [matSortDirection]="paginationParams().order ?? 'desc'"
            #sort="matSort"
            (matSortChange)="onSortChange($event)"
            class="seasons-table"
            aria-label="Seasons management table with sorting and pagination">

      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="id"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">ID</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-charcoal font-mono">{{ season.id }}</td>
      </ng-container>

      <!-- Year Column -->
      <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="year"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Year</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-charcoal font-semibold">{{ season.year }}</td>
      </ng-container>

      <!-- Start Date Column -->
      <ng-container matColumnDef="start_date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="start_date"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Start Date</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-charcoal">{{ formatDate(season.start_date) }}</td>
      </ng-container>

      <!-- End Date Column -->
      <ng-container matColumnDef="end_date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="end_date"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">End Date</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-charcoal">{{ formatDate(season.end_date) }}</td>
      </ng-container>

            <!-- Current Status Column -->
            <ng-container matColumnDef="is_current">
              <th mat-header-cell *matHeaderCellDef mat-sort-header="is_current"
                  class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Status</th>
              <td mat-cell *matCellDef="let season"
                  class="text-browers-charcoal">
                <span [ngClass]="{
                  'current-badge': isCurrentSeason(season.is_current),
                  'inactive-badge': isInactiveSeason(season.is_current)
                }">
                  {{ season.is_current ? 'Current' : 'Inactive' }}
                </span>
              </td>
            </ng-container>

      <!-- Created At Column -->
      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="created_at"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Created</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-dark-grey text-sm">{{ formatDate(season.created_at) }}</td>
      </ng-container>

      <!-- Updated At Column -->
      <ng-container matColumnDef="updated_at">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="updated_at"
          class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Updated</th>
        <td mat-cell *matCellDef="let season"
          class="text-browers-dark-grey text-sm">{{ formatDate(season.updated_at) }}</td>
      </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef
                  class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Actions</th>
              <td mat-cell *matCellDef="let season"
                  class="space-x-1">
                <button
                  mat-icon-button
                  color="primary"
                  [matTooltip]="'Edit ' + season.year"
                  (click)="updateSeason(season.id, season)"
                  aria-label="Edit season">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  [matTooltip]="'Delete ' + season.year"
                  (click)="deleteSeason(season.id)"
                  aria-label="Delete season">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-browers-light-grey sticky top-0 z-10"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-browers-light-grey hover:bg-opacity-50 transition-colors duration-150"></tr>
          </table>
        </div>
      }

      <!-- Mobile Card View -->
      @if (isMobile()) {
        <div class="mobile-cards-container space-y-4">
          @for (season of dataSource.data; track season.id) {
            <mat-card class="season-card bg-browers-white shadow-xs border border-browers-light-grey hover:shadow-md transition-shadow duration-200">
              <mat-card-content class="p-4">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex-1">
                    <h3 class="text-lg font-semibold text-browers-deep-purple">Season {{ season.year }}</h3>
                    <p class="text-browers-dark-grey text-sm">{{ formatDate(season.start_date) }} - {{ formatDate(season.end_date) }}</p>
                  </div>
                  <span [ngClass]="{
                    'current-badge': isCurrentSeason(season.is_current),
                    'inactive-badge': isInactiveSeason(season.is_current)
                  }">
                    {{ season.is_current ? 'Current' : 'Inactive' }}
                  </span>
                </div>

                <div class="grid grid-cols-1 gap-2 text-sm mb-4">
                  <div class="flex justify-between">
                    <span class="text-browers-steel-grey font-medium">ID:</span>
                    <span class="text-browers-charcoal font-mono">{{ season.id }}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-browers-steel-grey font-medium">Created:</span>
                    <span class="text-browers-dark-grey">{{ formatDate(season.created_at) }}</span>
                  </div>
                </div>

                <div class="flex space-x-2 justify-end">
                  <button
                    mat-stroked-button
                    color="primary"
                    [matTooltip]="'Edit ' + season.year"
                    (click)="updateSeason(season.id, season)"
                    class="flex-1"
                    aria-label="Edit season">
                    <mat-icon class="mr-1">edit</mat-icon>
                    Edit
                  </button>
                  <button
                    mat-stroked-button
                    color="warn"
                    [matTooltip]="'Delete ' + season.year"
                    (click)="deleteSeason(season.id)"
                    class="flex-1"
                    aria-label="Delete season">
                    <mat-icon class="mr-1">delete</mat-icon>
                    Delete
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }

      <!-- Paginator (responsive) -->
      <mat-paginator
        #paginator
        [length]="totalSeasons()"
        [pageSize]="paginationParams().pageSize"
        [pageIndex]="paginationParams().page"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        [showFirstLastButtons]="!isMobile()"
        aria-label="Select page of seasons"
        class="border-t border-browers-light-grey bg-browers-white mt-4">
      </mat-paginator>
    }

    <!-- No data message -->
    @if (!loading() && !error() && dataSource.data.length === 0) {
      <div class="no-data-message">
        <mat-icon class="text-browers-silver text-6xl mb-4">calendar_today</mat-icon>
        <p class="text-browers-steel-grey text-lg">No seasons found.</p>
        <p class="text-browers-steel-grey text-sm">Seasons will appear here when they are added to the system.</p>
      </div>
    }
  </mat-card-content>
</mat-card>