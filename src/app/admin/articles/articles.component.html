<mat-card class="articles-card shadow-xs">
  <!-- Skip link for keyboard navigation -->
  <a class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-browers-deep-purple text-browers-white px-4 py-2 rounded z-50"
    href="#articles-content">Skip to articles content</a>

  <mat-card-header class="border-b border-browers-light-grey pb-4">
    <mat-card-title class="text-browers-deep-purple text-xl font-semibold">Articles Management</mat-card-title>
    <mat-card-subtitle class="text-browers-dark-grey mt-1">View and manage news articles</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="pt-6" id="articles-content">
    <!-- Loading skeleton with screen reader announcements -->
    @if (paginatedArticles.isLoading()) {
    <!-- Screen reader announcement for loading state -->
    <div class="sr-only" aria-live="polite">Loading articles data, please wait...</div>

    <!-- Desktop Skeleton -->
    @if (!isMobile()) {
    <div class="skeleton-table" aria-hidden="true">
      <div class="skeleton-header bg-browers-light-grey h-12 mb-1"></div>
      @for (i of [1,2,3,4,5]; track i) {
      <div class="skeleton-row flex space-x-4 h-14 p-4 border-b border-browers-light-grey">
        <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-40 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-24 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
      </div>
      }
    </div>
    }

    <!-- Mobile Skeleton -->
    @if (isMobile()) {
    <div class="skeleton-cards space-y-4" aria-hidden="true">
      @for (i of [1,2,3]; track i) {
      <mat-card class="skeleton-card bg-browers-white shadow-xs border border-browers-light-grey">
        <mat-card-content class="p-4">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <div class="skeleton-text bg-browers-silver h-5 w-40 rounded animate-pulse mb-2"></div>
              <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
            </div>
            <div class="skeleton-image bg-browers-silver h-12 w-16 rounded animate-pulse"></div>
          </div>

          <div class="space-y-2 mb-4">
            <div class="flex justify-between">
              <div class="skeleton-text bg-browers-silver h-4 w-8 rounded animate-pulse"></div>
              <div class="skeleton-text bg-browers-silver h-4 w-20 rounded animate-pulse"></div>
            </div>
            <div class="flex justify-between">
              <div class="skeleton-text bg-browers-silver h-4 w-16 rounded animate-pulse"></div>
              <div class="skeleton-text bg-browers-silver h-4 w-24 rounded animate-pulse"></div>
            </div>
          </div>

          <div class="flex space-x-2">
            <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
            <div class="skeleton-button bg-browers-silver h-9 flex-1 rounded animate-pulse"></div>
          </div>
        </mat-card-content>
      </mat-card>
      }
    </div>
    }
    }

    <!-- Error message -->
    @if (paginatedArticles.error(); as err) {
    <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
      <mat-icon aria-hidden="true">error</mat-icon>
      <span class="font-medium">Error:</span>
      <span>{{ err }}</span>
    </div>
    }

    <!-- Articles table/cards -->
    @if (
    !paginatedArticles.isLoading() &&
    !paginatedArticles.error() &&
    (paginatedArticles.value()?.data?.items?.length ?? 0) > 0) {
      @let items = paginatedArticles.value()?.data?.items ?? [];
      @let total_count = paginatedArticles.value()?.data?.total_count ?? 0;
    <!-- Desktop Table View -->
    @if (!isMobile()) {
    <div class="table-container">
      <table mat-table [dataSource]="paginatedArticles.value()?.data?.items ?? []" matSort matSortDisableClear
        [matSortActive]="paginationParams().sort ?? 'date'" [matSortDirection]="paginationParams().order ?? 'desc'"
        #sort="matSort" (matSortChange)="onSortChange($event)" class="articles-table"
        aria-label="Articles management table with sorting and pagination">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="id"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">ID</th>
          <td mat-cell *matCellDef="let article" class="text-browers-charcoal font-mono">{{ article.id }}</td>
        </ng-container>

        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="title"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Title</th>
          <td mat-cell *matCellDef="let article" class="text-browers-charcoal font-normal max-w-xs">
            <span [matTooltip]="article.title" [matTooltipDisabled]="article.title.length <= 50">
              {{ article.title | slice:0:50 }}
            </span>
          </td>
        </ng-container>

        <!-- Season Column -->
        <ng-container matColumnDef="season">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="season"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Season</th>
          <td mat-cell *matCellDef="let article" class="text-browers-charcoal font-medium">{{ article.season.year }}
          </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="date"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Date</th>
          <td mat-cell *matCellDef="let article" class="text-browers-charcoal">{{ formatDate(article.date) }}</td>
        </ng-container>

        <!-- Banner Image Column -->
        <ng-container matColumnDef="img_banner">
          <th mat-header-cell *matHeaderCellDef
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Banner</th>
          <td mat-cell *matCellDef="let article" class="text-browers-charcoal">
            @if (hasBannerImage(article)) {
            <img [src]="article.img_banner" [alt]="article.title" class="w-12 h-8 object-cover rounded hover:scale-200">
            } @else {
            <span class="no-image-badge">No Image</span>
            }
          </td>
        </ng-container>

        <!-- Created At Column -->
        <ng-container matColumnDef="created_at">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="created_at"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Created</th>
          <td mat-cell *matCellDef="let article" class="text-browers-dark-grey text-sm">{{
            formatDate(article.created_at) }}</td>
        </ng-container>

        <!-- Updated At Column -->
        <ng-container matColumnDef="updated_at">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="updated_at"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Updated</th>
          <td mat-cell *matCellDef="let article" class="text-browers-dark-grey text-sm">{{
            formatDate(article.updated_at) }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Actions</th>
          <td mat-cell *matCellDef="let article" class="space-x-1">
            <button mat-icon-button color="primary" [matTooltip]="'Edit ' + article.title"
              (click)="updateArticle(article.id, article)"
              class="hover:bg-browers-light-purple hover:bg-opacity-10 focus:outline-hidden focus:ring-3 focus:ring-browers-deep-purple focus:ring-offset-1"
              aria-label="Edit article">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" [matTooltip]="'Delete ' + article.title"
              (click)="deleteArticle(article.id)"
              class="hover:bg-red-50 focus:outline-hidden focus:ring-3 focus:ring-red-500 focus:ring-offset-1"
              aria-label="Delete article">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-browers-light-grey sticky top-0 z-10"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
          class="hover:bg-browers-light-grey hover:bg-opacity-50 transition-colors duration-150"></tr>
      </table>
    </div>
    }

    <!-- Mobile Card View -->
    @if (isMobile()) {
    <div class="mobile-cards-container space-y-4">
      @for (article of items; track article.id) {
      <mat-card
        class="article-card bg-browers-white shadow-xs border border-browers-light-grey hover:shadow-md transition-shadow duration-200">
        <mat-card-content class="p-4">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-browers-deep-purple line-clamp-2">{{ article.title }}</h3>
              <p class="text-browers-dark-grey text-sm">Season {{ article.season.year }}</p>
            </div>
            @if (hasBannerImage(article)) {
            <img [src]="article.img_banner" [alt]="article.title" class="w-16 h-12 object-cover rounded ml-3">
            } @else {
            <div class="w-16 h-12 bg-browers-light-grey rounded ml-3 flex items-center justify-center">
              <mat-icon class="text-browers-silver">image</mat-icon>
            </div>
            }
          </div>

          <div class="grid grid-cols-1 gap-2 text-sm mb-4">
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">ID:</span>
              <span class="text-browers-charcoal font-mono">{{ article.id }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">Date:</span>
              <span class="text-browers-dark-grey">{{ formatDate(article.date) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">Created:</span>
              <span class="text-browers-dark-grey">{{ formatDate(article.created_at) }}</span>
            </div>
          </div>

          <div class="flex space-x-2 justify-end">
            <button mat-stroked-button color="primary" [matTooltip]="'Edit ' + article.title"
              (click)="updateArticle(article.id, article)"
              class="flex-1 hover:bg-browers-light-purple hover:bg-opacity-10 focus:outline-hidden focus:ring-3 focus:ring-browers-deep-purple focus:ring-offset-1"
              aria-label="Edit article">
              <mat-icon class="mr-1">edit</mat-icon>
              Edit
            </button>
            <button mat-stroked-button color="warn" [matTooltip]="'Delete ' + article.title"
              (click)="deleteArticle(article.id)"
              class="flex-1 hover:bg-red-50 focus:outline-hidden focus:ring-3 focus:ring-red-500 focus:ring-offset-1"
              aria-label="Delete article">
              <mat-icon class="mr-1">delete</mat-icon>
              Delete
            </button>
          </div>
        </mat-card-content>
      </mat-card>
      }
    </div>
    }

    <!-- Paginator (responsive) -->
    <mat-paginator #paginator [length]="total_count"
      [pageSize]="paginationParams().pageSize" [pageIndex]="paginationParams().page" [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)" [showFirstLastButtons]="!isMobile()" aria-label="Select page of articles"
      class="border-t border-browers-light-grey bg-browers-white mt-4">
    </mat-paginator>
    }

    <!-- No data message -->
    @if (
    !paginatedArticles.isLoading() &&
    !paginatedArticles.error() &&
      (paginatedArticles.value()?.data?.items?.length ?? 0) === 0
    )
    {
    <div class="no-data-message">
      <mat-icon class="text-browers-silver text-6xl mb-4">article</mat-icon>
      <p class="text-browers-steel-grey text-lg">No articles found.</p>
      <p class="text-browers-steel-grey text-sm">Articles will appear here when they are added to the system.</p>
    </div>
    }
  </mat-card-content>
</mat-card>