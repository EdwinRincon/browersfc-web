<mat-card class="lineups-card shadow-xs">
  <!-- Skip link for keyboard navigation -->
  <a class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-browers-deep-purple text-browers-white px-4 py-2 rounded z-50"
    href="#lineups-content">Skip to lineups content</a>

  <mat-card-header class="border-b border-browers-light-grey pb-4">
    <mat-card-title class="text-browers-deep-purple text-xl font-semibold">Lineups Management</mat-card-title>
    <mat-card-subtitle class="text-browers-dark-grey mt-1">View and manage team lineups</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="pt-6" id="lineups-content">
    <!-- Loading skeleton with screen reader announcements -->
    @if (paginatedLineups.isLoading()) {
    <div class="sr-only" aria-live="polite">Loading lineups data, please wait...</div>
    <div class="skeleton-table" aria-hidden="true">
      <div class="skeleton-header bg-browers-light-grey h-12 mb-1"></div>
      @for (i of [1,2,3,4,5]; track i) {
      <div class="skeleton-row flex space-x-4 h-14 p-4 border-b border-browers-light-grey">
        <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-40 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-24 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-16 rounded animate-pulse"></div>
        <div class="skeleton-cell bg-browers-silver h-6 w-20 rounded animate-pulse"></div>
      </div>
      }
    </div>
    }

    <!-- Error message -->
    @if (paginatedLineups.error(); as err) {
    <div class="error-message flex items-center gap-2 text-red-600 mb-6" role="alert" aria-live="polite">
      <mat-icon aria-hidden="true">error</mat-icon>
      <span class="font-medium">Error:</span>
      <span>{{ err.message }}</span>
    </div>
    }

    <!-- Lineups table/cards -->
    @if (
    !paginatedLineups.isLoading() &&
    !paginatedLineups.error() &&
    (paginatedLineups.value()?.data?.items?.length ?? 0) > 0
    ) {
    @let items = paginatedLineups.value()?.data?.items ?? [];
    @let total_count = paginatedLineups.value()?.data?.total_count ?? 0;
    <!-- Desktop Table View -->
    @if (!isMobile()) {
    <div class="table-container">
      <table mat-table [dataSource]="items" matSort matSortDisableClear
        [matSortActive]="paginationParams().sort ?? 'created_at'"
        [matSortDirection]="paginationParams().order ?? 'desc'" #sort="matSort" (matSortChange)="onSortChange($event)"
        class="lineups-table" aria-label="Lineups management table with sorting and pagination">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="id"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">ID</th>
          <td mat-cell *matCellDef="let lineup" class="text-browers-charcoal font-mono">{{ lineup.id }}</td>
        </ng-container>

        <!-- Match Column -->
        <ng-container matColumnDef="match">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="match"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Match</th>
          <td mat-cell *matCellDef="let lineup" class="text-browers-charcoal">
            <div class="text-sm">
              <p class="font-medium">{{ lineup.match?.location }}</p>
              @if (lineup.match) {
              <p class="text-browers-steel-grey">{{ lineup.match.kickoff | date:'MMM d, y' }}</p>
              }
            </div>
          </td>
        </ng-container>

        <!-- Player Column -->
        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="player"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Player</th>
          <td mat-cell *matCellDef="let lineup" class="text-browers-charcoal">
            <span class="font-medium">{{ lineup.player.nick_name }}</span>
          </td>
        </ng-container>

        <!-- Position Column -->
        <ng-container matColumnDef="position">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="position"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Position</th>
          <td mat-cell *matCellDef="let lineup">
            <span
              [class]="'inline-flex px-2 py-1 text-xs font-medium rounded-full ' + getPositionColor(lineup.position)">
              {{ lineup.position | uppercase }}
            </span>
          </td>
        </ng-container>

        <!-- Starting Column -->
        <ng-container matColumnDef="starting">
          <th mat-header-cell *matHeaderCellDef mat-sort-header="starting"
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Status</th>
          <td mat-cell *matCellDef="let lineup">
            @if (lineup.starting) {
            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
              TITULAR
            </span>
            } @else {
            <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800">
              SUPLENTE
            </span>
            }
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef
            class="text-xs font-medium text-browers-steel-grey uppercase tracking-wider">Actions</th>
          <td mat-cell *matCellDef="let lineup" class="space-x-1">
            <button mat-icon-button color="primary" [matTooltip]="'Edit lineup ' + lineup.id"
              (click)="editLineup(lineup)"
              class="hover:bg-browers-light-purple hover:bg-opacity-10 focus:outline-hidden focus:ring-3 focus:ring-browers-deep-purple focus:ring-offset-1"
              aria-label="Edit lineup">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" [matTooltip]="'Delete lineup ' + lineup.id"
              (click)="deleteLineup(lineup)"
              class="hover:bg-red-50 focus:outline-hidden focus:ring-3 focus:ring-red-500 focus:ring-offset-1"
              aria-label="Delete lineup">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-browers-light-grey sticky top-0 z-10"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
          class="hover:bg-browers-light-grey hover:bg-opacity-50 transition-colors duration-150"></tr>
      </table>
    </div>
    }

    <!-- Mobile Card View -->
    @if (isMobile()) {
    <div class="mobile-cards-container space-y-4">
      @for (lineup of items; track lineup.id) {
      <mat-card class="lineup-card bg-browers-white shadow-xs border border-browers-light-grey">
        <mat-card-content class="p-4">
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-browers-deep-purple line-clamp-2">{{ lineup?.match?.location }}</h3>
              @if (lineup.match) {
              <p class="text-browers-steel-grey text-sm">{{ lineup.match.kickoff | date:'MMM d, y' }}</p>
              }
            </div>
          </div>
          <div class="grid grid-cols-1 gap-2 text-sm mb-4">
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">Player:</span>
              <span class="text-browers-charcoal font-mono">{{ lineup.player.nick_name }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">Position:</span>
              <span class="text-browers-dark-grey">{{ lineup.position | uppercase }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-browers-steel-grey font-medium">Status:</span>
              @if (lineup.starting) {
              <span
                class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">TITULAR</span>
              } @else {
              <span
                class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-orange-100 text-orange-800">SUPLENTE</span>
              }
            </div>
          </div>
          <div class="flex space-x-2 justify-end">
            <button mat-stroked-button color="primary" [matTooltip]="'Edit lineup ' + lineup.id"
              (click)="editLineup(lineup)"
              class="flex-1 hover:bg-browers-light-purple hover:bg-opacity-10 focus:outline-hidden focus:ring-3 focus:ring-browers-deep-purple focus:ring-offset-1"
              aria-label="Edit lineup">
              <mat-icon class="mr-1">edit</mat-icon>
              Edit
            </button>
            <button mat-stroked-button color="warn" [matTooltip]="'Delete lineup ' + lineup.id"
              (click)="deleteLineup(lineup)"
              class="flex-1 hover:bg-red-50 focus:outline-hidden focus:ring-3 focus:ring-red-500 focus:ring-offset-1"
              aria-label="Delete lineup">
              <mat-icon class="mr-1">delete</mat-icon>
              Delete
            </button>
          </div>
        </mat-card-content>
      </mat-card>
      }
    </div>
    }

    <!-- Paginator (responsive) -->
    <mat-paginator #paginator [length]="total_count" [pageSize]="paginationParams().pageSize"
      [pageIndex]="paginationParams().page" [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)"
      [showFirstLastButtons]="!isMobile()" aria-label="Select page of lineups"
      class="border-t border-browers-light-grey bg-browers-white mt-4">
    </mat-paginator>
    }

    <!-- No data message -->
    @if (
    !paginatedLineups.isLoading() &&
    !paginatedLineups.error() &&
    (paginatedLineups.value()?.data?.items?.length ?? 0) === 0
    ) {
    <div class="no-data-message">
      <mat-icon class="text-browers-silver text-6xl mb-4">group</mat-icon>
      <p class="text-browers-steel-grey text-lg">No lineups found.</p>
      <p class="text-browers-steel-grey text-sm">Lineups will appear here when they are added to the system.</p>
    </div>
    }

    <!-- 7-a-side Pitch Builder (always visible) -->
    <admin-lineup-pitch (saveLineup)="onSaveLineup($event)" />
  </mat-card-content>
</mat-card>